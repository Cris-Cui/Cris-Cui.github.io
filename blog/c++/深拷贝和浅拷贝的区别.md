# C++深拷贝和浅拷贝的区别

> 在有指针的情况下, 浅拷贝只是增加了一个指针指向已经存在的内存，而深拷贝是增加一个指针并且申请一个新的内存，试这个增加的指针指向这个新的内存,将原指针指向的内容拷贝到新的内存中。

## 浅拷贝存在的问题:

多个对象的成员指针指向同一个内存，当该内存被某一对象释放掉后，对其他对象是不可见的，回出现**重复释放同一内存**的错误 .

## **为什么拷贝构造函数和赋值函数是浅拷贝而不是深拷贝?**

1. 性能: 深拷贝涉及到内存分配和复制，这些操作会耗费时间和资源，在某些情况下，对象的成员可能没有指针或需要深拷贝的情况很少。使用浅拷贝可以获得更好的性能。
2. 开发者控制:C++赋予开发者更大的灵活性和控制权
3. C++设计哲学: **你不会支付你不需要的东西的成本**。

**当对象中存在指针类型成员时, 除了在复制对象时考虑自定义拷贝构造函数， 还应该考虑以下两种情形:**

1. 当函数的参数为类对象时， 实参传递给形参实际上是一个拷贝的对象，系统自动通过拷贝构造实现。
2. 当函数的返回值为一个对象时，该对象实际上是函数内对象的一个拷贝，用于返回函数调用处。

浅拷贝带来的问题的本质是在于析构函数对同一块内存空间多次释放，使用C++11智能指针[`shared_ptr`](./blog/c++/C++11 智能指针.md)可以完美的解决这个问题。

